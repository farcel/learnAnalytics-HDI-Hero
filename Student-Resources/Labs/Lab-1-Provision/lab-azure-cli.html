<h1 id="manage-hadoop-clusters-using-azure-cli---azure-hdinsight">Manage Hadoop clusters using Azure CLI - Azure HDInsight</h1>
<h2 id="links">Links</h2>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-administer-use-command-line">Manage HDInsight Clusters with Azure CLI</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-hadoop-create-linux-clusters-azure-cli">Create HDInsight Clusters using the Azure CLI</a></li>
</ul>
<p>The Azure-CLI is a Node.js utility for managing Azure resources using a command-line interface.</p>
<p><strong>Note</strong> - there is a new cli-utility written in Python, <a href="https://github.com/Azure/azure-cli">azure-cli 2.0</a>, but it does not yet support provisioning HDInsight clusters.</p>
<h3 id="create-a-new-resource-group-and-storage-account">Create a New Resource Group and Storage Account</h3>
<p>We'll first create a new resource group and storage account for our cluster. Take a look at the script: <code>create-sa.sh</code>.</p>
<h1 id="usrbinenv-bash">!/usr/bin/env bash</h1>
<h1 id="description-this-script-creates-a-storage-account-and-prints-keys">description :This script creates a storage account and prints keys</h1>
<h1 id="author-ali-zaidi-github-akzaidi-contact-alizaidi-at-microsoft-dot-com">author :Ali Zaidi (github: akzaidi; contact alizaidi at microsoft dot com)</h1>
<h1 id="date-2017-08-24">date :2017-08-24</h1>
<h1 id="version-0.1">version :0.1</h1>
<h1 id="notes-requires-azure-cli-and-you-must-login-prior-to-usage-azure-login.">notes :Requires azure CLI, and you must login prior to usage, azure login.</h1>
<h1 id="section">====================================================================================</h1>
<h1 id="set-resource-manager-mode">set resource manager mode</h1>
<p>azure config mode arm</p>
<h1 id="parameters-for-storage-account">parameters for storage account</h1>
<p>yourname=$(whoami) class=&quot;hdiclass&quot;</p>
<p>ARG1=<span class="math inline">${1:-$</span>yourname<span class="math inline">$class} RG=$</span>ARG1</p>
<p>ARG2=<span class="math inline">2 : −<em>c</em><em>e</em><em>n</em><em>t</em><em>r</em><em>a</em><em>l</em><em>u</em><em>s</em><em>L</em><em>O</em><em>C</em>=</span>ARG2</p>
<p>sa=&quot;sa&quot; ARG3=<span class="math inline">${3:-$</span>yourname<span class="math inline">$sa} SA=$</span>ARG3</p>
<h1 id="create-resource-group">create resource group</h1>
<p>printf &quot;Creating resource group %s in region %s&quot; &quot;<span class="math inline">$RG&quot; &quot;$</span>LOC&quot;</p>
<p>azure group create $RG $LOC</p>
<h1 id="create-storage-account">create storage account</h1>
<p>printf &quot;Creating storage account %s&quot; &quot;$SA&quot;</p>
<p>azure storage account create -g<br />
$RG --sku-name RAGRS -l $LOC<br />
--kind Storage $SA</p>
<h1 id="print-keys">print keys</h1>
<p>azure storage account keys list -g $RG $SA</p>
<p>This script will create a resource group and a storage account for you, and print out the key for the storage account. Keep note of the key.</p>
<h3 id="provision-cluster">Provision Cluster</h3>
<p>Pass the key from the previous script as the first argument to the script <code>provision-cluster.sh</code>, i.e., <code>./provision-cluster.sh $KEY</code></p>
<h1 id="usrbinenv-bash">!/usr/bin/env bash</h1>
<h1 id="description-this-script-provisions-an-hdinsight-cluster">description :This script provisions an HDInsight cluster</h1>
<h1 id="author-ali-zaidi-github-akzaidi-contact-alizaidi-at-microsoft-dot-com">author :Ali Zaidi (github: akzaidi; contact alizaidi at microsoft dot com)</h1>
<h1 id="date-2017-08-24">date :2017-08-24</h1>
<h1 id="version-0.1">version :0.1</h1>
<h1 id="notes-requires-azure-cli-and-you-must-login-prior-to-usage-azure-login.">notes :Requires azure CLI, and you must login prior to usage, azure login.</h1>
<h1 id="section">====================================================================================</h1>
<h1 id="set-resource-manager-mode">set resource manager mode</h1>
<p>azure config mode arm</p>
<p>yourname=$(whoami) class=&quot;hdiclass&quot;</p>
<p>ARG1=<span class="math inline"><em>y</em><em>o</em><em>u</em><em>r</em><em>n</em><em>a</em><em>m</em><em>e</em></span>class RG=$ARG1</p>
<p>ARG2=&quot;centralus&quot; LOC=$ARG2</p>
<p>sa=&quot;sa&quot; ARG3=<span class="math inline"><em>y</em><em>o</em><em>u</em><em>r</em><em>n</em><em>a</em><em>m</em><em>e</em></span>sa blob=&quot;.blob.core.windows.net&quot; SA=<span class="math inline"><em>A</em><em>R</em><em>G</em>3</span>blob</p>
<p>CTYPE=&quot;spark&quot;</p>
<p>SKEY=&quot;$1&quot;</p>
<p>PASS=${2:-&quot;PassHDI123!&quot;}</p>
<p>clust=&quot;clust&quot; CNAME=<span class="math inline">${3:-$</span>RG$clust}</p>
<p>printf &quot;Creating cluster named %s in resource group %s&quot; &quot;<span class="math inline">$CNAME&quot; &quot;$</span>RG&quot;</p>
<p>azure hdinsight cluster create -g $RG<br />
-l $LOC -y Linux --clusterType $CTYPE<br />
--defaultStorageAccountName $SA<br />
--defaultStorageAccountKey $SKEY --defaultStorageContainer<br />
clustername --workerNodeCount 2 --userName admin --password<br />
$PASS --sshUserName sshuser<br />
--sshPassword $PASS $CNAME</p>
<p>You should now have a brand new cluster!</p>
